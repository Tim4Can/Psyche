{"remainingRequest":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\src\\views\\staff\\staffManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\src\\views\\staff\\staffManage.vue","mtime":1562869728000},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1573722996621},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\babel-loader\\lib\\index.js","mtime":1573725483614},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1573722996621},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1573725517685}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { STable } from '@/components'\nimport { PageView } from '@/layouts'\nimport { getStaffSheet, deleteStaffSheetRow, modifyStaffSheetRow, addStaffSheetRow } from '@/api/staff'\nimport Fuse from 'fuse.js'\nimport md5 from 'md5'\nimport ARow from \"ant-design-vue/es/grid/Row\";\nimport ACol from \"ant-design-vue/es/grid/Col\";\n\nconst statusMap = {\n  0: {\n    status: 'processing',\n    text: '巡检员'\n  },\n  1: {\n    status: 'success',\n    text: '维修员'\n  },\n  2: {\n    status: 'error',\n    text: '调度员'\n  }\n}\n\nexport default {\n  name: 'TableList',\n  inject: ['reload'],\n  components: {\n    ACol,\n    ARow,\n    PageView,\n    STable\n  },\n  data () {\n    return {\n\n      visible: false,\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 5 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 }\n      },\n      form: null,\n      mdl: {},\n      visible2: false,\n      visible3:false,\n      visible4:false,\n      visible5:false,\n      editPassword:false,\n      passwordCheck:\"disabled\",\n      newmdl:{\n        'id':'',\n        'name':'',\n        'accountID':'',\n        'password':'',\n        'status':'',\n        'telNumber':'',\n        'idCardNumber':'',\n        'startTime':'',\n        'endTime':''\n      },\n      addmdl:{\n        'name':'',\n        'password':'',\n        'status':'0',\n        'telNumber':'',\n        'idCardNumber':'',\n        'startTime':'周一',\n        'endTime':'周日'\n      },\n      input:'',\n      input2: '',\n      input3:'',\n      sfData:[],\n      sfDataShow:[],\n      statusMap,\n      todelete:'',\n      deleteInfo:'',\n      modifyInfo:'',\n      addInfo:'',\n      accountInfo:'',\n\n      // 高级搜索 展开/关闭\n      advanced: false,\n      // 查询参数\n      queryParam: {},\n      // 表头\n      columns: [\n        {\n          title: '员工编号',\n          dataIndex: 'id',\n          align:'center',\n          sorter:(a,b) => a.id > b.id\n        },\n        {\n          title: '员工姓名',\n          align:'center',\n          dataIndex: 'name'\n        },\n        {\n          title: '登录账号',\n          align:'center',\n          dataIndex: 'accountID'\n        },\n         {\n          title: '员工身份',\n          align:'center',\n          dataIndex: 'status',\n          filters:[{\n            text:'巡检员',\n            value:'0'\n          },{\n            text:'维修员',\n            value:'1',\n          },{\n            text:'调度员',\n            value:'2'\n          }],\n          onFilter:(value,record) => record.status.indexOf(value) === 0,\n          scopedSlots: { customRender: 'status' }\n        },{\n          title: '操作',\n          align:'center',\n          width: '150px',\n          dataIndex: 'action',\n          scopedSlots: { customRender: 'action' }\n        }\n      ],\n\n      selectedRowKeys: [],\n      selectedRows: []\n    }\n  },\n  created () {\n    getStaffSheet().then((response) => {\n      console.log(...response.data)\n      this.sfData = [...response.data]\n      this.sfDataShow = this.sfData\n    })\n  },\n  watch:{\n    input(pattern){\n          if(pattern == ''){\n              this.sfDataShow = this.sfData\n          }\n          else{\n              const option = {\n                  keys: ['id'],\n                  threshold: 0.1\n              }\n              var fuse = new Fuse(this.sfData,option)\n              this.sfDataShow = fuse.search(pattern)\n          }\n      },\n      input2(pattern){\n          if(pattern == ''){\n              this.sfDataShow = this.sfData\n          }\n          else{\n              const option = {\n                  keys: ['name'],\n                  threshold: 0.1\n              }\n              var fuse = new Fuse(this.sfData,option)\n              this.sfDataShow = fuse.search(pattern)\n          }\n      },\n      input3(pattern){\n          if(pattern == ''){\n              this.sfDataShow = this.sfData\n          }\n          else{\n              const option = {\n                  keys: ['accountID'],\n                  threshold: 0.1\n              }\n              var fuse = new Fuse(this.sfData,option)\n              this.sfDataShow = fuse.search(pattern)\n          }\n      }\n  },\n  computed:{\n      successName: function(){\n        if(this.newmdl.name === ''){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successTel: function(){\n        if(this.newmdl.telNumber.length !== 11){\n          return \"error\"\n        }\n        if(!(/(^[0-9]\\d*$)/.test(this.newmdl.telNumber))){\n          return \"error\"\n      }else{\n        return \"success\"\n      }\n      },\n      successIdcard: function(){\n        if(this.newmdl.idCardNumber.length !== 18){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successPassword: function(){\n        if(!this.editPassword){\n          return \"success\"\n        }\n        if(this.newmdl.password.length < 8||this.newmdl.password.length > 12){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      ifRepair: function(){\n        console.log(\"visible\",this.newmdl.status)\n        if(this.newmdl.status === '1'){\n          console.log(\"disabled\")\n          return \"disabled\"\n        }\n      },\n      successAddName: function(){\n        if(this.addmdl.name === ''){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successAddPassword: function(){\n        if(this.addmdl.password.length < 8 ||this.addmdl.password.length > 12){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successAddTel: function(){\n        if(this.addmdl.telNumber.length !== 11){\n          return \"error\"\n        }\n        if(!(/(^[0-9]\\d*$)/.test(this.addmdl.telNumber))){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successAddIdNumber: function(){\n        if(this.addmdl.idCardNumber.length !== 18){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      ifAddRepair: function(){\n        console.log(\"status\",this.addmdl.status)\n        if(this.addmdl.status === '1'){\n          console.log(\"disabled\")\n          return \"disabled\"\n        }\n      },\n  },\n  filters: {\n    statusFilter (type) {\n      return statusMap[type].text\n    },\n    statusTypeFilter (type) {\n      return statusMap[type].status\n    }\n  },\n  methods: {\n    handleEdit (record) {\n      this.mdl = Object.assign({}, record)\n      this.newmdl.id = this.mdl.id\n      this.newmdl.name = this.mdl.name\n      this.newmdl.accountID = this.mdl.accountID\n      this.newmdl.status = this.mdl.status\n      this.newmdl.telNumber = this.mdl.detail[0].var\n      this.newmdl.idCardNumber=this.mdl.detail[1].var\n      this.newmdl.startTime = this.mdl.detail[4].var\n      this.newmdl.endTime = this.mdl.detail[5].var\n      console.log('detail',this.mdl.detail[0])\n\n      this.visible = true\n    },\n    handleOk () {\n      if(this.successName === \"error\"||this.successTel === \"error\"||\n      this.successIdcard === \"error\"||this.successPassword === \"error\"){\n        this.$notification.open({\n          message: '修改失败',\n          description: '请按要求填写员工新信息',\n          icon: <a-icon type=\"exclamation-circle\" style=\"color: #108ee9\" />,\n        });\n        return;\n      }\n      this.visible2 = true\n    },\n    handlenewOk(){\n      this.visible =false\n      this.visible2 = false\n      if(this.editPassword){\n        this.newmdl.password = md5(this.newmdl.password)\n      }\n      this.newmdl.password = this.mdl.password\n      modifyStaffSheetRow(this.newmdl).then((response) => {\n        this.modifyInfo = response.info\n        if(this.modifyInfo === 'ok'){\n          this.newmdl.password=''\n          this.$notification.open({\n          message: '修改成功',\n          description: '本条员工记录修改成功',\n          icon: <a-icon type=\"check\" style=\"color: #108ee9\" />,\n        });\n        this.sfData = [...response.data]\n          this.sfDataShow = this.sfData\n        }\n        else{\n          this.$notification.open({\n          message: '修改失败',\n          description: '本条员工记录修改失败',\n          icon: <a-icon type=\"warning\" style=\"color: #108ee9\" />,\n        });\n        }\n      })\n    },\n    handlenewnewOk(){\n      if(this.successAddName === \"error\"||this.successAddTel === \"error\"||\n      this.successAddIdNumber === \"error\"||this.successAddPassword === \"error\"){\n        this.$notification.open({\n          message: '添加失败',\n          description: '请按要求填写新员工信息',\n          icon: <a-icon type=\"exclamation-circle\" style=\"color: #108ee9\" />,\n        });\n        return;\n      }\n      this.visible5 = true\n\n    },\n    modifyPassword(){\n      this.editPassword = true\n      this.passwordCheck = false\n    },\n    onClickDelete (id) {\n      console.log(id)\n      this.todelete = id\n      this.visible3 = true;\n    },\n    //delete row\n    onClickDeleteRow () {\n      this.visible2 = false\n      this.visible3 = false\n      const newData = [...this.sfDataShow]\n      console.log(newData)\n      const target = newData.filter(item => this.todelete === item.id)[0]\n      console.log(target)\n      deleteStaffSheetRow({id:target.id}).then((response) => {\n        this.deleteInfo = response.info\n        if(this.deleteInfo === 'ok'){\n          this.sfData = [...response.data]\n          this.sfDataShow = this.sfData\n          this.$notification.open({\n          message: '删除成功',\n          description: '本条员工记录删除成功',\n          icon: <a-icon type=\"check\" style=\"color: #108ee9\" />,\n        });\n        }\n        else{\n          this.$notification.open({\n          message: '删除失败',\n          description: '本条员工记录删除失败',\n          icon: <a-icon type=\"warning\" style=\"color: #108ee9\" />,\n        });\n        }\n      })\n\n    },\n    onClickRefresh(){\n      this.reload()\n    },\n    onChange (selectedRowKeys, selectedRows) {\n      this.selectedRowKeys = selectedRowKeys\n      this.selectedRows = selectedRows\n    },\n    toggleAdvanced () {\n      this.advanced = !this.advanced\n    },\n    handleAdd () {\n      this.visible4 = true\n    },\n    onClickNewRow(){\n      this.visible4 = false\n      this.visible5 = false\n       this.addmdl.password = md5(this.addmdl.password)\n       addStaffSheetRow(this.addmdl).then((response) => {\n        this.addInfo = response.info1\n        this.accountInfo = response.info2\n        if(this.addInfo === 'ok'){\n          this.$notification.open({\n          message: '添加成功',\n          description: '本条员工记录添加成功。新员工的账号为'+this.accountInfo,\n          icon: <a-icon type=\"check\" style=\"color: #108ee9\" />,\n        });\n          this.sfData = [...response.data]\n          this.sfDataShow = this.sfData\n        }\n        else{\n          this.$notification.open({\n          message: '添加失败',\n          description: '本条员工记录添加失败',\n          icon: <a-icon type=\"warning\" style=\"color: #108ee9\" />,\n        });\n        }\n      })\n    }\n  }\n}\n",{"version":3,"sources":["staffManage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiWA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"staffManage.vue","sourceRoot":"src/views/staff","sourcesContent":["<template>\n  <page-view title=\"员工管理\">\n    <a-card :bordered=\"false\">\n      <div class=\"table-page-search-wrapper\">\n        <a-form layout=\"inline\">\n          <a-row :gutter=\"48\">\n            <a-col :md=\"8\" :sm=\"24\">\n              <a-form-item label=\"根据编号查找员工\">\n                <a-input placeholder=\"请输入员工编号\" v-model=\"input\"/>\n              </a-form-item>\n            </a-col>\n            <a-col :md=\"8\" :sm=\"24\">\n              <a-form-item label=\"根据姓名查找员工\">\n                <a-input placeholder=\"请输入员工姓名\" v-model=\"input2\"/>\n              </a-form-item>\n            </a-col>\n            <a-col :md=\"8\" :sm=\"24\">\n              <a-form-item label=\"根据账号查找员工\">\n                <a-input placeholder=\"请输入员工账号\" v-model=\"input3\"/>\n              </a-form-item>\n            </a-col>\n          </a-row>\n          <a-row :gutter=\"48\">\n            <a-col style=\" textAlign: 'left' margin-bottom: 24px\">\n              <a-button\n                size=\"large\"\n                class=\"button\"\n                type=\"primary\"\n                @click=\"onClickRefresh\"\n              >刷新表单\n              </a-button>\n              <br>\n            </a-col>\n            <a-col style=\" textAlign: 'right' margin-bottom: 24px\">\n              <div class=\"addButton\">\n                <a-button type=\"primary\" color=\"#108ee9\" size=\"large\" icon=\"plus\" @click=\"handleAdd\">新建</a-button>\n              </div>\n            </a-col>\n          </a-row>\n        </a-form>\n      </div>\n\n      <a-table\n        size=\"default\"\n        :columns=\"columns\"\n        :dataSource=\"sfDataShow\"\n        rowKey='id'\n        style=\" margin-top: 24px\"\n      >\n\n        <div\n          slot=\"expandedRowRender\"\n          slot-scope=\"record\"\n          style=\"margin: 0\">\n          <a-row\n            :gutter=\"24\"\n            :style=\"{ marginBottom: '12px' }\">\n            <a-col :span=\"12\" v-for=\"(role, index) in record.detail\" :key=\"index\" :style=\"{ marginBottom: '12px' }\">\n\n              <a-col :lg=\"8\" :md=\"24\" :span=\"20\">\n                <a-tag color='cyan'>{{ role.roleName }}：</a-tag>\n              </a-col>\n              <a-col :lg=\"14\">{{role.var}}</a-col>\n            </a-col>\n          </a-row>\n        </div>\n        <template slot='status' slot-scope=\"text\">\n          <a-badge :status=\"text | statusTypeFilter\" :text=\"text | statusFilter\"/>\n        </template>\n        <span slot=\"action\" slot-scope=\"text, record\">\n        <a @click=\"handleEdit(record)\">修改</a>\n        <a-divider type=\"vertical\"/>\n        <a @click=\"onClickDelete(record.id)\">删除</a>\n        <a-modal\n          title=\"确认删除\"\n          v-model=\"visible3\"\n          @ok=\"onClickDeleteRow\"\n        >\n                <div class=\"modal\">\n                    是否删除本条记录\n                </div></a-modal>\n      </span>\n      </a-table>\n\n      <a-modal\n        title=\"修改员工信息\"\n        style=\"top: 20px;\"\n        :width=\"800\"\n        v-model=\"visible\"\n        @ok=\"handleOk\"\n      >\n\n        <a-form :from=\"(form)=>{this.form = form} \" rowKey='id' bordered>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"员工编号\"\n            hasFeedback\n            validateStatus=\"success\"\n          >\n            <a-input placeholder=\"员工编号\" v-model=\"newmdl.id\" id=\"no\" disabled=\"disabled\"/>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"员工姓名\"\n            hasFeedback\n            :validateStatus=\"successName\"\n          >\n            <a-input placeholder=\"新名字\" v-model=\"newmdl.name\" id=\"role_name\"/>\n          </a-form-item>\n\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"员工身份\"\n            hasFeedback\n            validateStatus=\"success\"\n          >\n            <a-select disabled v-model=\"mdl.status\">\n              <a-select-option value=\"0\">巡检员</a-select-option>\n              <a-select-option value=\"1\">维修员</a-select-option>\n              <a-select-option value=\"2\">调度员</a-select-option>\n            </a-select>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"登录账号\"\n            hasFeedback\n            validateStatus=\"success\"\n          >\n            <a-input disabled=\"disabled\" v-model=\"newmdl.accountID\" id=\"role_name\"/>\n          </a-form-item>\n\n      \n          <a-row :gutter=\"24\" style=\"margin-left: 2rem\">\n            <a-col :md=\"24\" :lg=\"18\">\n              <a-form-item\n                :labelCol=\"labelCol\"\n                :wrapperCol=\"wrapperCol\"\n                label=\"密码\"\n                hasFeedback\n                :validateStatus=\"successPassword\"\n              >\n                <a-input :disabled=\"passwordCheck\" placeholder=\"新密码(8-12位)\" v-model=\"newmdl.password\" id=\"role_password\"/>\n              </a-form-item>\n            </a-col>\n            <a-col :md=\"24\" :lg=\"6\">\n              <a-button @click=\"modifyPassword\">\n                编辑\n              </a-button>\n            </a-col>\n          </a-row>\n\n       \n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"电话\"\n            hasFeedback\n            :validateStatus=\"successTel\"\n          >\n            <a-input placeholder=\"新电话(11位)\" v-model=\"newmdl.telNumber\" id=\"role_telnumber\"/>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"身份证号码\"\n            hasFeedback\n            :validateStatus=\"successIdcard\"\n          >\n            <a-input placeholder=\"重新填写身份证号码(18位)\" v-model=\"newmdl.idCardNumber\" id=\"role_idCard\"/>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"每周工作开始时间\"\n            hasFeedback\n            validateStatus=\"success\"\n            visible='false'\n          >\n            <a-select :disabled=\"ifRepair\" v-model=\"newmdl.startTime\">\n              <a-select-option value=\"周一\">周一</a-select-option>\n              <a-select-option value=\"周二\">周二</a-select-option>\n              <a-select-option value=\"周三\">周三</a-select-option>\n              <a-select-option value=\"周四\">周四</a-select-option>\n              <a-select-option value=\"周五\">周五</a-select-option>\n              <a-select-option value=\"周六\">周六</a-select-option>\n              <a-select-option value=\"周日\">周日</a-select-option>\n            </a-select>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"每周工作结束时间\"\n            hasFeedback\n            validateStatus=\"success\"\n          >\n            <a-select :disabled=\"ifRepair\" v-model=\"newmdl.endTime\">\n              <a-select-option value=\"周一\">周一</a-select-option>\n              <a-select-option value=\"周二\">周二</a-select-option>\n              <a-select-option value=\"周三\">周三</a-select-option>\n              <a-select-option value=\"周四\">周四</a-select-option>\n              <a-select-option value=\"周五\">周五</a-select-option>\n              <a-select-option value=\"周六\">周六</a-select-option>\n              <a-select-option value=\"周日\">周日</a-select-option>\n            </a-select>\n          </a-form-item>\n        \n          <a-divider/>\n        \n\n        </a-form>\n        <a-modal\n          title=\"确认修改\"\n          v-model=\"visible2\"\n          @ok=\"handlenewOk\"\n        >\n          <div class=\"modal\">\n            是否确认修改\n          </div>\n        </a-modal>\n      </a-modal>\n\n\n      <a-modal\n        title=\"添加新员工\"\n        style=\"top: 20px;\"\n        :width=\"800\"\n        v-model=\"visible4\"\n        @ok=\"handlenewnewOk\"\n      >\n        <a-form :from=\"(form)=>{this.form = form} \" rowKey='id' bordered>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"员工姓名\"\n            :validateStatus=\"successAddName\"\n            hasFeedback\n          >\n            <a-input placeholder=\"请输入新用户姓名\" v-model=\"addmdl.name\" id=\"role_name\"/>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"员工身份\"\n            hasFeedback\n            validateStatus=\"success\"\n          >\n            <a-select v-model=\"addmdl.status\">\n              <a-select-option value=\"0\">巡检员</a-select-option>\n              <a-select-option value=\"1\">维修员</a-select-option>\n              <a-select-option value=\"2\">调度员</a-select-option>\n            </a-select>\n          </a-form-item>\n\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"密码\"\n            hasFeedback\n            :validateStatus=\"successAddPassword\"\n          >\n            <a-input placeholder=\"请输入新用户密码(8-12位)\" v-model=\"addmdl.password\" id=\"role_password\"/>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"电话\"\n            hasFeedback\n            :validateStatus=\"successAddTel\"\n          >\n            <a-input placeholder=\"请填写新用户电话(11位)\" v-model=\"addmdl.telNumber\" id=\"role_telnumber\"/>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"身份证号码\"\n            hasFeedback\n            :validateStatus=\"successAddIdNumber\"\n          >\n            <a-input placeholder=\"请填写新用户身份证号码(18位)\" v-model=\"addmdl.idCardNumber\" id=\"role_idCard\"/>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"每周工作开始时间\"\n            validateStatus=\"success\"\n            hasFeedback\n          >\n            <a-select :disabled=\"ifAddRepair\" v-model=\"addmdl.startTime\">\n              <a-select-option value=\"周一\">周一</a-select-option>\n              <a-select-option value=\"周二\">周二</a-select-option>\n              <a-select-option value=\"周三\">周三</a-select-option>\n              <a-select-option value=\"周四\">周四</a-select-option>\n              <a-select-option value=\"周五\">周五</a-select-option>\n              <a-select-option value=\"周六\">周六</a-select-option>\n              <a-select-option value=\"周日\">周日</a-select-option>\n            </a-select>\n          </a-form-item>\n\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"每周工作结束时间\"\n            validateStatus=\"success\"\n            hasFeedback\n          >\n            <a-select :disabled=\"ifAddRepair\" v-model=\"addmdl.endTime\">\n              <a-select-option value=\"周一\">周一</a-select-option>\n              <a-select-option value=\"周二\">周二</a-select-option>\n              <a-select-option value=\"周三\">周三</a-select-option>\n              <a-select-option value=\"周四\">周四</a-select-option>\n              <a-select-option value=\"周五\">周五</a-select-option>\n              <a-select-option value=\"周六\">周六</a-select-option>\n              <a-select-option value=\"周日\">周日</a-select-option>\n            </a-select>\n          </a-form-item>\n\n\n        </a-form>\n        <a-modal\n          title=\"确认添加\"\n          v-model=\"visible5\"\n          @ok=\"onClickNewRow\"\n        >\n          <div class=\"modal\">\n            是否确认添加\n          </div>\n        </a-modal>\n      </a-modal>\n\n\n    </a-card>\n  </page-view>\n</template>\n\n<script>\nimport { STable } from '@/components'\nimport { PageView } from '@/layouts'\nimport { getStaffSheet, deleteStaffSheetRow, modifyStaffSheetRow, addStaffSheetRow } from '@/api/staff'\nimport Fuse from 'fuse.js'\nimport md5 from 'md5'\nimport ARow from \"ant-design-vue/es/grid/Row\";\nimport ACol from \"ant-design-vue/es/grid/Col\";\n\nconst statusMap = {\n  0: {\n    status: 'processing',\n    text: '巡检员'\n  },\n  1: {\n    status: 'success',\n    text: '维修员'\n  },\n  2: {\n    status: 'error',\n    text: '调度员'\n  }\n}\n\nexport default {\n  name: 'TableList',\n  inject: ['reload'],\n  components: {\n    ACol,\n    ARow,\n    PageView,\n    STable\n  },\n  data () {\n    return {\n\n      visible: false,\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 5 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 }\n      },\n      form: null,\n      mdl: {},\n      visible2: false,\n      visible3:false,\n      visible4:false,\n      visible5:false,\n      editPassword:false,\n      passwordCheck:\"disabled\",\n      newmdl:{\n        'id':'',\n        'name':'',\n        'accountID':'',\n        'password':'',\n        'status':'',\n        'telNumber':'',\n        'idCardNumber':'',\n        'startTime':'',\n        'endTime':''\n      },\n      addmdl:{\n        'name':'',\n        'password':'',\n        'status':'0',\n        'telNumber':'',\n        'idCardNumber':'',\n        'startTime':'周一',\n        'endTime':'周日'\n      },\n      input:'',\n      input2: '',\n      input3:'',\n      sfData:[],\n      sfDataShow:[],\n      statusMap,\n      todelete:'',\n      deleteInfo:'',\n      modifyInfo:'',\n      addInfo:'',\n      accountInfo:'',\n\n      // 高级搜索 展开/关闭\n      advanced: false,\n      // 查询参数\n      queryParam: {},\n      // 表头\n      columns: [\n        {\n          title: '员工编号',\n          dataIndex: 'id',\n          align:'center',\n          sorter:(a,b) => a.id > b.id\n        },\n        {\n          title: '员工姓名',\n          align:'center',\n          dataIndex: 'name'\n        },\n        {\n          title: '登录账号',\n          align:'center',\n          dataIndex: 'accountID'\n        },\n         {\n          title: '员工身份',\n          align:'center',\n          dataIndex: 'status',\n          filters:[{\n            text:'巡检员',\n            value:'0'\n          },{\n            text:'维修员',\n            value:'1',\n          },{\n            text:'调度员',\n            value:'2'\n          }],\n          onFilter:(value,record) => record.status.indexOf(value) === 0,\n          scopedSlots: { customRender: 'status' }\n        },{\n          title: '操作',\n          align:'center',\n          width: '150px',\n          dataIndex: 'action',\n          scopedSlots: { customRender: 'action' }\n        }\n      ],\n\n      selectedRowKeys: [],\n      selectedRows: []\n    }\n  },\n  created () {\n    getStaffSheet().then((response) => {\n      console.log(...response.data)\n      this.sfData = [...response.data]\n      this.sfDataShow = this.sfData\n    })\n  },\n  watch:{\n    input(pattern){\n          if(pattern == ''){\n              this.sfDataShow = this.sfData\n          }\n          else{\n              const option = {\n                  keys: ['id'],\n                  threshold: 0.1\n              }\n              var fuse = new Fuse(this.sfData,option)\n              this.sfDataShow = fuse.search(pattern)\n          }\n      },\n      input2(pattern){\n          if(pattern == ''){\n              this.sfDataShow = this.sfData\n          }\n          else{\n              const option = {\n                  keys: ['name'],\n                  threshold: 0.1\n              }\n              var fuse = new Fuse(this.sfData,option)\n              this.sfDataShow = fuse.search(pattern)\n          }\n      },\n      input3(pattern){\n          if(pattern == ''){\n              this.sfDataShow = this.sfData\n          }\n          else{\n              const option = {\n                  keys: ['accountID'],\n                  threshold: 0.1\n              }\n              var fuse = new Fuse(this.sfData,option)\n              this.sfDataShow = fuse.search(pattern)\n          }\n      }\n  },\n  computed:{\n      successName: function(){\n        if(this.newmdl.name === ''){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successTel: function(){\n        if(this.newmdl.telNumber.length !== 11){\n          return \"error\"\n        }\n        if(!(/(^[0-9]\\d*$)/.test(this.newmdl.telNumber))){\n          return \"error\"\n      }else{\n        return \"success\"\n      }\n      },\n      successIdcard: function(){\n        if(this.newmdl.idCardNumber.length !== 18){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successPassword: function(){\n        if(!this.editPassword){\n          return \"success\"\n        }\n        if(this.newmdl.password.length < 8||this.newmdl.password.length > 12){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      ifRepair: function(){\n        console.log(\"visible\",this.newmdl.status)\n        if(this.newmdl.status === '1'){\n          console.log(\"disabled\")\n          return \"disabled\"\n        }\n      },\n      successAddName: function(){\n        if(this.addmdl.name === ''){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successAddPassword: function(){\n        if(this.addmdl.password.length < 8 ||this.addmdl.password.length > 12){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successAddTel: function(){\n        if(this.addmdl.telNumber.length !== 11){\n          return \"error\"\n        }\n        if(!(/(^[0-9]\\d*$)/.test(this.addmdl.telNumber))){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      successAddIdNumber: function(){\n        if(this.addmdl.idCardNumber.length !== 18){\n          return \"error\"\n        }\n        return \"success\"\n      },\n      ifAddRepair: function(){\n        console.log(\"status\",this.addmdl.status)\n        if(this.addmdl.status === '1'){\n          console.log(\"disabled\")\n          return \"disabled\"\n        }\n      },\n  },\n  filters: {\n    statusFilter (type) {\n      return statusMap[type].text\n    },\n    statusTypeFilter (type) {\n      return statusMap[type].status\n    }\n  },\n  methods: {\n    handleEdit (record) {\n      this.mdl = Object.assign({}, record)\n      this.newmdl.id = this.mdl.id\n      this.newmdl.name = this.mdl.name\n      this.newmdl.accountID = this.mdl.accountID\n      this.newmdl.status = this.mdl.status\n      this.newmdl.telNumber = this.mdl.detail[0].var\n      this.newmdl.idCardNumber=this.mdl.detail[1].var\n      this.newmdl.startTime = this.mdl.detail[4].var\n      this.newmdl.endTime = this.mdl.detail[5].var\n      console.log('detail',this.mdl.detail[0])\n\n      this.visible = true\n    },\n    handleOk () {\n      if(this.successName === \"error\"||this.successTel === \"error\"||\n      this.successIdcard === \"error\"||this.successPassword === \"error\"){\n        this.$notification.open({\n          message: '修改失败',\n          description: '请按要求填写员工新信息',\n          icon: <a-icon type=\"exclamation-circle\" style=\"color: #108ee9\" />,\n        });\n        return;\n      }\n      this.visible2 = true\n    },\n    handlenewOk(){\n      this.visible =false\n      this.visible2 = false\n      if(this.editPassword){\n        this.newmdl.password = md5(this.newmdl.password)\n      }\n      this.newmdl.password = this.mdl.password\n      modifyStaffSheetRow(this.newmdl).then((response) => {\n        this.modifyInfo = response.info\n        if(this.modifyInfo === 'ok'){\n          this.newmdl.password=''\n          this.$notification.open({\n          message: '修改成功',\n          description: '本条员工记录修改成功',\n          icon: <a-icon type=\"check\" style=\"color: #108ee9\" />,\n        });\n        this.sfData = [...response.data]\n          this.sfDataShow = this.sfData\n        }\n        else{\n          this.$notification.open({\n          message: '修改失败',\n          description: '本条员工记录修改失败',\n          icon: <a-icon type=\"warning\" style=\"color: #108ee9\" />,\n        });\n        }\n      })\n    },\n    handlenewnewOk(){\n      if(this.successAddName === \"error\"||this.successAddTel === \"error\"||\n      this.successAddIdNumber === \"error\"||this.successAddPassword === \"error\"){\n        this.$notification.open({\n          message: '添加失败',\n          description: '请按要求填写新员工信息',\n          icon: <a-icon type=\"exclamation-circle\" style=\"color: #108ee9\" />,\n        });\n        return;\n      }\n      this.visible5 = true\n\n    },\n    modifyPassword(){\n      this.editPassword = true\n      this.passwordCheck = false\n    },\n    onClickDelete (id) {\n      console.log(id)\n      this.todelete = id\n      this.visible3 = true;\n    },\n    //delete row\n    onClickDeleteRow () {\n      this.visible2 = false\n      this.visible3 = false\n      const newData = [...this.sfDataShow]\n      console.log(newData)\n      const target = newData.filter(item => this.todelete === item.id)[0]\n      console.log(target)\n      deleteStaffSheetRow({id:target.id}).then((response) => {\n        this.deleteInfo = response.info\n        if(this.deleteInfo === 'ok'){\n          this.sfData = [...response.data]\n          this.sfDataShow = this.sfData\n          this.$notification.open({\n          message: '删除成功',\n          description: '本条员工记录删除成功',\n          icon: <a-icon type=\"check\" style=\"color: #108ee9\" />,\n        });\n        }\n        else{\n          this.$notification.open({\n          message: '删除失败',\n          description: '本条员工记录删除失败',\n          icon: <a-icon type=\"warning\" style=\"color: #108ee9\" />,\n        });\n        }\n      })\n\n    },\n    onClickRefresh(){\n      this.reload()\n    },\n    onChange (selectedRowKeys, selectedRows) {\n      this.selectedRowKeys = selectedRowKeys\n      this.selectedRows = selectedRows\n    },\n    toggleAdvanced () {\n      this.advanced = !this.advanced\n    },\n    handleAdd () {\n      this.visible4 = true\n    },\n    onClickNewRow(){\n      this.visible4 = false\n      this.visible5 = false\n       this.addmdl.password = md5(this.addmdl.password)\n       addStaffSheetRow(this.addmdl).then((response) => {\n        this.addInfo = response.info1\n        this.accountInfo = response.info2\n        if(this.addInfo === 'ok'){\n          this.$notification.open({\n          message: '添加成功',\n          description: '本条员工记录添加成功。新员工的账号为'+this.accountInfo,\n          icon: <a-icon type=\"check\" style=\"color: #108ee9\" />,\n        });\n          this.sfData = [...response.data]\n          this.sfDataShow = this.sfData\n        }\n        else{\n          this.$notification.open({\n          message: '添加失败',\n          description: '本条员工记录添加失败',\n          icon: <a-icon type=\"warning\" style=\"color: #108ee9\" />,\n        });\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.addButton{\n    position: absolute;\n    z-index: 999;\n    right:1em;\n    top:0em;\n  }\n</style>"]}]}