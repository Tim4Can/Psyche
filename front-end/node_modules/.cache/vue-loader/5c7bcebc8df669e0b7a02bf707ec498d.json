{"remainingRequest":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\src\\views\\warehouse\\Map.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\src\\views\\warehouse\\Map.vue","mtime":1562869728000},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1573722996621},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\babel-loader\\lib\\index.js","mtime":1573725483614},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1573722996621},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\db-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1573725517685}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport BMap from 'BMap'\nimport router from '../../router'\nimport warehouseMarker from '../../assets/marker/warehouse.png'\nimport usingEquipMarker from '../../assets/marker/usingEquipment.png'\nimport {getAllWarehouse, getWarehousePreview, getAll} from '@/api/warehouse'\nimport {getEquipmentStoredList, getEquipmentUsingList} from '@/api/equipment'\nimport {getAccesoryInWarehouse, getAccessoryInWarehouse} from '@/api/accessory'\n\n\nimport { TreeSelect } from 'ant-design-vue'\nvar overlays = []\nconst SHOW_PARENT = TreeSelect.SHOW_PARENT\nconst functionBox = {\n  '0-0': [\"仓库\", getWarehousePreview],\n  '0-1': ['在用器材',getEquipmentUsingList],\n}\n\nconst treeData = [{\n  title: '仓库',\n  value: '0-0',\n  key: '0-0',\n}, \n{\n  title: '在用器材',\n  value: '0-1',\n  key: '0-1',\n}]\n\nfunction refreshMapContainer() {\n  var mapContainer = document.getElementById('pleaseresize')\n  var h = document.getElementsByClassName('ant-layout-content')[0].offsetHeight\n  mapContainer.setAttribute('style', 'height:' + h + 'px;')\n}\n\nconst startPoint = new BMap.Point(116.404, 39.915)\n\nfunction initialize() {\n  const map = new BMap.Map('map')\n  window.map = map\n  // window.map.centerAndZoom(startPoint, 15)\n  map.enableScrollWheelZoom(true)\n  // 覆盖区域图层测试\n  map.addTileLayer(new BMap.PanoramaCoverageLayer())\n  \n  var stCtrl = new BMap.PanoramaControl() // 构造全景控件\n  stCtrl.setOffset(new BMap.Size(20, 20))\n  map.addControl(stCtrl) // 添加全景控件\n  var loadCount = 1\n  // map.addEventListener('tilesloaded', function () {\n  //   if (loadCount === 1) {\n  //     map.setCenter(startPoint)\n  //   }\n  //   loadCount = loadCount + 1\n  // })\n}\n\nfunction addTestWarehouseMarker() {\n  var pt = new BMap.Point(116.417, 39.909)\n  var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\n  var marker = new BMap.Marker(startPoint, { icon: myIcon })\n  window.map.addOverlay(marker)\n  var marker2 = new BMap.Marker(pt, { icon: myIcon }) // 创建标注\n  window.map.addOverlay(marker2) // 将标注添加到地图中\n  console.log('Test Marker added!')\n}\n\nexport function jumpWarehouse(id){\n  router.push('/warehouse/detail/'+id)\n}\nwindow.initialize = initialize\n\nexport default {\n  name: 'Map',\n  data() {\n    return {\n      value: ['0-0', '0-1'],\n      treeData,\n      SHOW_PARENT\n    }\n  },\n  methods: {\n    loadScript() {\n      var script = document.createElement('script')\n      script.src = 'http://api.map.baidu.com/api?v=2.0&ak=CvqBqDrjbtb6R31TBqy5zCFz1fUtuNZQ&callback=initialize'\n      document.body.appendChild(script)\n      console.log('script appended')\n    },\n    onChange(value) {\n      console.log('onChange ', value)\n      this.value = value\n      this.refreshMap()\n    },\n    appendWarehouse(address, id, name, lat, lon){\n      var point = new BMap.Point(lon, lat)\n      var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\n      var marker = new BMap.Marker(point, { icon: myIcon })\n      var sContent =\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${name}</h4>` + \n      `<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>${address}</p>` + \n      \"</div>\";\n      var infoWindow = new BMap.InfoWindow(sContent);\n      marker.addEventListener(\"mouseover\", function(){\n        this.openInfoWindow(infoWindow)\n      })\n      marker.addEventListener(\"mouseout\", function(){\n        this.closeInfoWindow(infoWindow)\n      })\n      marker.addEventListener(\"onclick\", function(){\n        router.push(\"/warehouse/detail/\" + id)\n      })\n      overlays.push(marker)\n      window.map.addOverlay(marker)\n    },\n    appendEquipment(address, lat, lon, model, pic, qrCode, type, id){\n      var point = new BMap.Point(lon, lat)\n      var myIcon = new BMap.Icon(usingEquipMarker, new BMap.Size(70, 70))\n      var marker = new BMap.Marker(point, { icon: myIcon })\n      var sContent =\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${type} : ${model}</h4>` + \n      `<img style='float:right;margin:4px' id='imgDemo' src='${pic}' width='70' height='70' title='${type} : ${model}'/>` +\n       `<img style='float:right;margin:4px' id='imgDemo' src='${qrCode}' width='70' height='70' title='${type} : ${model}'/>` +\n      `<p style='margin:0;line-height:1.5;font-size:13px;'>${address}</p>` + \n      \"</div>\";\n      var infoWindow = new BMap.InfoWindow(sContent);\n      marker.addEventListener(\"mouseover\", function(){\n        this.openInfoWindow(infoWindow)\n        document.getElementById('imgDemo').onload = function (){\n          infoWindow.redraw();   \n        }\n      })\n      marker.addEventListener(\"mouseout\", function(){\n        this.closeInfoWindow(infoWindow)\n      })\n      marker.addEventListener(\"onclick\", function(){\n        router.push(\"/equipment/detail/\" + id)\n      })\n      overlays.push(marker)\n      window.map.addOverlay(marker)\n    },\n    refreshMap(){\n      for(var overlay of overlays){\n        window.map.removeOverlay(overlay)\n      }\n      getAll().then( response =>{\n        var warehouses = response.data.warehouse\n        var equips = response.data.usingEquipment\n        for(var v of this.value){\n          var type = functionBox[v][0]\n          if(type == \"仓库\"){\n            for(var warehouse of warehouses){\n              var id = warehouse.id\n              var lat = warehouse.lat\n              var lon = warehouse.lon\n              var name = warehouse.name\n              var detailedAddress = warehouse.detailedAddress\n              this.appendWarehouse(detailedAddress, id, name, lat, lon)\n            }\n          }\n          else{\n            console.log(\"在用器材\")\n            for(var equip of equips){\n              var detailedAddress = equip.detailedAddress\n              var lat = equip.lat\n              var lon = equip.lon\n              var model = equip.model\n              var pic = equip.pic\n              var qrCode = equip.qrCode\n              var type = equip.type\n              var id = equip.id\n              this.appendEquipment(detailedAddress, lat, lon, model, pic, qrCode, type, id)\n            }\n          }\n        }\n\n        console.log(response)\n      })\n\n\n\n      // for(var v of this.value){\n      //   var typeFunctionPair = functionBox[v]\n      //   var type = typeFunctionPair[0]\n      //   var func = typeFunctionPair[1]\n      //   if(type == \"仓库\"){\n      //     func().then( response => {\n      //         console.log(response.data)\n      //         var warehouseData = [...response.data]\n      //         for(var warehouse of warehouseData){\n      //           var address = warehouse.address\n      //           var id = warehouse.id\n      //           var name = warehouse.name\n      //           console.log(address, id)\n      //           this.translateAddress(address, id, name)\n      //         }\n      //     })\n      //   }\n      //   else{\n      //     func().then( response => {\n      //       console.log(response)\n      //     })\n      //   }\n      // }\n      var TJJD = new BMap.Point(121.222, 31.291)\n      window.map.centerAndZoom(TJJD, 16)\n    }\n  },\n  mounted() {\n    // this.loadScript()\n    refreshMapContainer()\n    // window.onresize = () => {\n    //   refreshMapContainer()\n    // }\n    initialize()\n    this.refreshMap()\n    // addTestWarehouseMarker()\n  }\n}\n",{"version":3,"sources":["Map.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAwBA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Map.vue","sourceRoot":"src/views/warehouse","sourcesContent":["/* eslint-disable */\n\n<template>\n  <div id=\"pleaseresize\">\n    <a-layout id=\"map-components\" style=\"height:100%;\">\n      <a-layout-content>\n        <div class=\"map\" id=\"map\" style=\"height:100%\"></div>\n      </a-layout-content>\n      <a-layout-sider theme=\"light\">\n        <a-tree-select\n          :treeData=\"treeData\"\n          :value=\"value\"\n          @change=\"onChange\"\n          treeCheckable\n          :showCheckedStrategy=\"SHOW_PARENT\"\n          searchPlaceholder=\"Please select\"\n          style=\"width:100%;\"\n        />\n      </a-layout-sider>\n    </a-layout>\n  </div>\n</template>\n\n<script>\nimport BMap from 'BMap'\nimport router from '../../router'\nimport warehouseMarker from '../../assets/marker/warehouse.png'\nimport usingEquipMarker from '../../assets/marker/usingEquipment.png'\nimport {getAllWarehouse, getWarehousePreview, getAll} from '@/api/warehouse'\nimport {getEquipmentStoredList, getEquipmentUsingList} from '@/api/equipment'\nimport {getAccesoryInWarehouse, getAccessoryInWarehouse} from '@/api/accessory'\n\n\nimport { TreeSelect } from 'ant-design-vue'\nvar overlays = []\nconst SHOW_PARENT = TreeSelect.SHOW_PARENT\nconst functionBox = {\n  '0-0': [\"仓库\", getWarehousePreview],\n  '0-1': ['在用器材',getEquipmentUsingList],\n}\n\nconst treeData = [{\n  title: '仓库',\n  value: '0-0',\n  key: '0-0',\n}, \n{\n  title: '在用器材',\n  value: '0-1',\n  key: '0-1',\n}]\n\nfunction refreshMapContainer() {\n  var mapContainer = document.getElementById('pleaseresize')\n  var h = document.getElementsByClassName('ant-layout-content')[0].offsetHeight\n  mapContainer.setAttribute('style', 'height:' + h + 'px;')\n}\n\nconst startPoint = new BMap.Point(116.404, 39.915)\n\nfunction initialize() {\n  const map = new BMap.Map('map')\n  window.map = map\n  // window.map.centerAndZoom(startPoint, 15)\n  map.enableScrollWheelZoom(true)\n  // 覆盖区域图层测试\n  map.addTileLayer(new BMap.PanoramaCoverageLayer())\n  \n  var stCtrl = new BMap.PanoramaControl() // 构造全景控件\n  stCtrl.setOffset(new BMap.Size(20, 20))\n  map.addControl(stCtrl) // 添加全景控件\n  var loadCount = 1\n  // map.addEventListener('tilesloaded', function () {\n  //   if (loadCount === 1) {\n  //     map.setCenter(startPoint)\n  //   }\n  //   loadCount = loadCount + 1\n  // })\n}\n\nfunction addTestWarehouseMarker() {\n  var pt = new BMap.Point(116.417, 39.909)\n  var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\n  var marker = new BMap.Marker(startPoint, { icon: myIcon })\n  window.map.addOverlay(marker)\n  var marker2 = new BMap.Marker(pt, { icon: myIcon }) // 创建标注\n  window.map.addOverlay(marker2) // 将标注添加到地图中\n  console.log('Test Marker added!')\n}\n\nexport function jumpWarehouse(id){\n  router.push('/warehouse/detail/'+id)\n}\nwindow.initialize = initialize\n\nexport default {\n  name: 'Map',\n  data() {\n    return {\n      value: ['0-0', '0-1'],\n      treeData,\n      SHOW_PARENT\n    }\n  },\n  methods: {\n    loadScript() {\n      var script = document.createElement('script')\n      script.src = 'http://api.map.baidu.com/api?v=2.0&ak=CvqBqDrjbtb6R31TBqy5zCFz1fUtuNZQ&callback=initialize'\n      document.body.appendChild(script)\n      console.log('script appended')\n    },\n    onChange(value) {\n      console.log('onChange ', value)\n      this.value = value\n      this.refreshMap()\n    },\n    appendWarehouse(address, id, name, lat, lon){\n      var point = new BMap.Point(lon, lat)\n      var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\n      var marker = new BMap.Marker(point, { icon: myIcon })\n      var sContent =\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${name}</h4>` + \n      `<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>${address}</p>` + \n      \"</div>\";\n      var infoWindow = new BMap.InfoWindow(sContent);\n      marker.addEventListener(\"mouseover\", function(){\n        this.openInfoWindow(infoWindow)\n      })\n      marker.addEventListener(\"mouseout\", function(){\n        this.closeInfoWindow(infoWindow)\n      })\n      marker.addEventListener(\"onclick\", function(){\n        router.push(\"/warehouse/detail/\" + id)\n      })\n      overlays.push(marker)\n      window.map.addOverlay(marker)\n    },\n    appendEquipment(address, lat, lon, model, pic, qrCode, type, id){\n      var point = new BMap.Point(lon, lat)\n      var myIcon = new BMap.Icon(usingEquipMarker, new BMap.Size(70, 70))\n      var marker = new BMap.Marker(point, { icon: myIcon })\n      var sContent =\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${type} : ${model}</h4>` + \n      `<img style='float:right;margin:4px' id='imgDemo' src='${pic}' width='70' height='70' title='${type} : ${model}'/>` +\n       `<img style='float:right;margin:4px' id='imgDemo' src='${qrCode}' width='70' height='70' title='${type} : ${model}'/>` +\n      `<p style='margin:0;line-height:1.5;font-size:13px;'>${address}</p>` + \n      \"</div>\";\n      var infoWindow = new BMap.InfoWindow(sContent);\n      marker.addEventListener(\"mouseover\", function(){\n        this.openInfoWindow(infoWindow)\n        document.getElementById('imgDemo').onload = function (){\n          infoWindow.redraw();   \n        }\n      })\n      marker.addEventListener(\"mouseout\", function(){\n        this.closeInfoWindow(infoWindow)\n      })\n      marker.addEventListener(\"onclick\", function(){\n        router.push(\"/equipment/detail/\" + id)\n      })\n      overlays.push(marker)\n      window.map.addOverlay(marker)\n    },\n    refreshMap(){\n      for(var overlay of overlays){\n        window.map.removeOverlay(overlay)\n      }\n      getAll().then( response =>{\n        var warehouses = response.data.warehouse\n        var equips = response.data.usingEquipment\n        for(var v of this.value){\n          var type = functionBox[v][0]\n          if(type == \"仓库\"){\n            for(var warehouse of warehouses){\n              var id = warehouse.id\n              var lat = warehouse.lat\n              var lon = warehouse.lon\n              var name = warehouse.name\n              var detailedAddress = warehouse.detailedAddress\n              this.appendWarehouse(detailedAddress, id, name, lat, lon)\n            }\n          }\n          else{\n            console.log(\"在用器材\")\n            for(var equip of equips){\n              var detailedAddress = equip.detailedAddress\n              var lat = equip.lat\n              var lon = equip.lon\n              var model = equip.model\n              var pic = equip.pic\n              var qrCode = equip.qrCode\n              var type = equip.type\n              var id = equip.id\n              this.appendEquipment(detailedAddress, lat, lon, model, pic, qrCode, type, id)\n            }\n          }\n        }\n\n        console.log(response)\n      })\n\n\n\n      // for(var v of this.value){\n      //   var typeFunctionPair = functionBox[v]\n      //   var type = typeFunctionPair[0]\n      //   var func = typeFunctionPair[1]\n      //   if(type == \"仓库\"){\n      //     func().then( response => {\n      //         console.log(response.data)\n      //         var warehouseData = [...response.data]\n      //         for(var warehouse of warehouseData){\n      //           var address = warehouse.address\n      //           var id = warehouse.id\n      //           var name = warehouse.name\n      //           console.log(address, id)\n      //           this.translateAddress(address, id, name)\n      //         }\n      //     })\n      //   }\n      //   else{\n      //     func().then( response => {\n      //       console.log(response)\n      //     })\n      //   }\n      // }\n      var TJJD = new BMap.Point(121.222, 31.291)\n      window.map.centerAndZoom(TJJD, 16)\n    }\n  },\n  mounted() {\n    // this.loadScript()\n    refreshMapContainer()\n    // window.onresize = () => {\n    //   refreshMapContainer()\n    // }\n    initialize()\n    this.refreshMap()\n    // addTestWarehouseMarker()\n  }\n}\n</script>\n\n<style>\n/* #map-components {\n    width:50%;\n    height: 100%;\n  }\n  #map {\n    height: 100%;\n  }\n  #container {\n    height: 100%;\n  } */\n\n.checkbox-vertical {\n  display: block;\n  margin-right: 0;\n}\n\n/* #map-layout{\n    height: 100%;\n  } */\n\n/* .ant-layout-content{\n    height: 100%;\n  } */\n/* html,body{\n    width: 100%;\n    height: 100%;\n  } */\n</style>\n"]}]}